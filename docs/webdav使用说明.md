# WebDAV 功能使用说明

## 功能概述

已成功为您的视频播放器集成 WebDAV 网络存储功能，可以直接播放 WebDAV 服务器上的视频文件。

## 使用步骤

### 1. 打开 WebDAV 功能

在应用主页，点击**右下角的云朵图标**（蓝色圆形按钮）。

### 2. 首次配置

首次点击会弹出配置对话框，需要填写以下信息：

#### 必填项：
- **服务器地址**：WebDAV 服务器的完整地址
  - 例如：`https://dav.jianguoyun.com/dav/`
  - 必须以 `http://` 或 `https://` 开头
  - 建议以 `/` 结尾

- **显示名称**：自定义的名称（可选，默认为"WebDAV媒体库"）

#### 登录模式：
- **账号登录**：需要提供账号和密码
  - 账号：您的 WebDAV 用户名
  - 密码：您的 WebDAV 密码（对于坚果云等服务，这里填写**应用密码**，不是登录密码）
  
- **匿名登录**：无需账号密码（仅适用于公开访问的 WebDAV 服务器）

### 3. 测试连接

填写完信息后，点击**"测试连接"**按钮：
- ✓ 连接成功：显示绿色提示
- ✗ 连接失败：显示红色提示，请检查配置

### 4. 保存配置

确认连接成功后，点击**"保存"**按钮。配置会被加密保存到本地。

### 5. 浏览文件

保存配置后，会自动进入 WebDAV 文件浏览界面：
- 文件夹显示橙色图标
- 视频文件显示蓝色图标
- 点击文件夹可以进入子目录
- 点击视频文件即可开始播放

### 6. 返回上一级

- 点击左上角的返回按钮可以返回上一级目录
- 在根目录时点击返回会退出 WebDAV 浏览

## 常见问题

### Q1: 连接失败怎么办？
**A:** 请检查：
1. 服务器地址是否正确（注意 http/https）
2. 账号密码是否正确
3. 网络连接是否正常
4. 防火墙是否拦截

### Q2: 坚果云如何获取应用密码？
**A:** 
1. 登录坚果云网页版
2. 进入"账户信息" → "安全选项"
3. 找到"第三方应用管理"
4. 添加应用并生成密码
5. 将生成的密码填入配置对话框的"密码"栏

### Q3: 支持哪些视频格式？
**A:** 支持常见的所有视频格式：
- mp4, mkv, avi, mov, wmv, flv, webm
- m4v, 3gp, ts, rmvb, rm, mpg, mpeg

### Q4: 如何修改 WebDAV 配置？
**A:** 再次点击主页右下角的云朵图标，会弹出配置对话框，可以修改现有配置。

### Q5: 播放卡顿怎么办？
**A:**
1. 检查网络速度
2. 降低视频质量
3. 使用国内的 WebDAV 服务商（如坚果云）
4. 考虑先下载到本地再播放

## 推荐的 WebDAV 服务

### 国内服务（速度快）
- **坚果云**：免费版每月1GB上传，3GB下载
  - 地址：`https://dav.jianguoyun.com/dav/`

### 自建服务
- **Alist**：支持多种云存储后端
- **Nextcloud**：功能全面的私有云
- **Seafile**：专注文件同步
- **NAS 设备**：群晖、威联通等

## 技术特性

- ✅ 支持 HTTPS 加密传输
- ✅ 支持自签名证书
- ✅ 密码加密存储
- ✅ 支持账号和匿名两种登录模式
- ✅ 自动识别视频文件
- ✅ 支持文件夹导航
- ✅ 支持大文件播放

## 注意事项

1. **首次使用请务必先测试连接**，确保配置正确
2. **账号密码会加密保存**在本地，安全可靠
3. **播放网络视频需要稳定的网络连接**
4. **建议使用 HTTPS 协议**以保证传输安全
5. **大文件播放可能需要一定的缓冲时间**

---

## 开发信息

### 使用的核心库：
- **Sardine 1.0.2**：WebDAV 客户端库
- **Simple XML 2.7.1**：XML 解析库
- **OkHttp**：网络请求库
- **EncryptedSharedPreferences**：加密存储

### 代码位置：
- `WebDavConfig.kt`：配置管理
- `WebDavClient.kt`：WebDAV 客户端
- `WebDavConfigDialog.kt`：配置对话框
- `WebDavBrowserActivity.kt`：文件浏览器
- `WebDavFileAdapter.kt`：文件列表适配器

---

如有问题或建议，欢迎反馈！
