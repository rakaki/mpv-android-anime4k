# 开发计划

## 近期规划的功能

### 1. Compose 重构设置页面 ⭐⭐

**目标**：将现有的 XML 设置页面改为 Compose 实现

**收益**：
- 更现代化的 UI 体验
- 代码量减少约 40%
- 更容易维护和扩展
- Material Design 3 风格

**实施步骤**：
1. 创建 `SettingsScreen.kt` (Compose 版本)
2. 实现各个设置分组 (外观、播放、字幕、弹幕等)
3. 迁移现有设置逻辑
4. 替换旧的 `SettingsActivity`

**预计工期**：3-5 天

---

### 2. 主题切换完整性修复 ⭐⭐⭐

**问题**：当前主题切换存在割裂感，部分界面背景颜色不会改变

**根本原因**：布局文件使用了硬编码颜色 (如 `#222222`)，而非主题属性 (`?attr/...`)

**解决方案**：
- 在 `attrs.xml` 中定义自定义主题属性
- 修改所有布局文件使用主题属性
- 为每个主题定义完整的配色方案

**需要修改的文件**：
- `fragment_home.xml` - 主页背景和文字颜色
- `activity_video_browser.xml` - 文件夹列表背景
- `activity_video_list.xml` - 视频列表背景
- 其他使用硬编码颜色的布局

**预计工期**：5-7 天

---

### 3. 字幕搜索下载功能 ⭐⭐

**目标**：集成字幕网站 API，让用户手动搜索下载字幕

**技术方案**：

**方案 A：OpenSubtitles API**
- 需要申请 API Key
- 支持多语言字幕
- 质量高，资源丰富

**方案 B：射手网 API** (推荐)
- 无需 API Key
- 基于视频文件哈希匹配
- 中文字幕资源丰富
- 完全免费

**功能设计**：
1. 播放器界面添加"搜索字幕"按钮
2. 点击后自动提取视频文件名/哈希
3. 显示搜索结果列表
4. 用户选择后自动下载并加载

**预计工期**：2-3 天

---

### 4. 视频补帧功能 ⭐

**背景**：SVP 技术已过时，需要使用现代化方案

**方案对比**：

| 方案 | 难度 | 效果 | 性能要求 |
|------|------|------|----------|
| MPV 内置补帧 | ⭐ | ⭐⭐⭐ | 低 |
| RIFE AI 补帧 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 高 (旗舰芯片) |

**推荐：先实现 MPV 内置补帧**

**实现代码**：
```kotlin
// 在 PlaybackEngine.kt 中添加
fun enableInterpolation(enabled: Boolean) {
    if (enabled) {
        MPVLib.setOptionString("video-sync", "display-resample")
        MPVLib.setOptionString("interpolation", "yes")
        MPVLib.setOptionString("tscale", "oversample")
    } else {
        MPVLib.setOptionString("interpolation", "no")
    }
}
```

**UI 设置项**：
- 在播放设置中添加"运动补帧"开关
- 提示：需要较高性能设备

**预计工期**：1 天

---

## 实施路线图

### 第一阶段 (1-2周)
- [x] ~~项目代码优化 (已完成)~~
- [ ] MPV 内置补帧 (最简单，立即见效)
- [ ] 主题切换完整性修复

### 第二阶段 (2-3周)
- [ ] Compose 重构设置页面
- [ ] 字幕搜索下载功能

### 第三阶段 (长期)
- [ ] RIFE AI 补帧研究 (可选，如果 MPV 补帧效果不满意)
- [ ] 更多功能探索

---

## 技术储备

### Compose 相关
- 项目已集成 Compose (用于 B站登录和播放界面)
- 熟悉 Material Design 3 组件

### 网络请求
- 已使用 OkHttp 处理 B站 API
- 可复用现有网络层代码

### MPV 集成
- 已深度封装 libmpv
- 可直接调用 MPV 高级特性

---

## 注意事项

1. **主题切换**：需要系统性修改，避免遗漏任何界面
2. **字幕搜索**：注意处理网络异常和无结果情况
3. **补帧功能**：提示用户性能影响，建议高性能设备开启
4. **测试覆盖**：每个功能完成后充分测试不同场景

---

**Last Updated**: 2025-11-15
